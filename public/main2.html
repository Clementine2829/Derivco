<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="=viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie-edge" />
	<title>Graduate Assessment: Good Match</title>
	<!-- JQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="js/jquery-3.4.1.js" type="text/javascript"></script>
	<script src="js/calculate.js" type="text/javascript"></script>
	
	<link rel="stylesheet" href="./css/style.css" />
</head>
<body>
	<div id="container">
		<div>
			<h2>Graduate Assessment: Good Match</h2>
			<h5>Main program 1 with no file upload</h5>
			<p>
				<a href="main1.html">Main 1</a> |
				<a href="main2.html">Main 2</a>
			</p>
		</div>
		<div>
			<input type="file" name="inputfile" id="inputfile">	<br>
			<pre id="output"></pre>
		</div>
	</div>

	<script type="text/javascript">
		var TEXT_OUTPUT = [];
		document.getElementById('inputfile').addEventListener('change', function(){
			let people = [];
			var fr = new FileReader();
			fr.onload = function(){
				document.getElementById('output').textContent = fr.result;
				people = fr.result.split('\n');
				console.log(people);
				sort_names(people);
			}
			fr.readAsText(this.files[0]);
		})

		function sort_names(arr) {
			let male = [];
			let female = [];
			for(let i = 0; i < arr.length; i++){
				//the expected string will start with a number then a full stop then the name of the person their gender, like below 
				//1.Kimberly, f
				//hence i am reading from the 3rd char not from start
				let current_person = arr[i].substring(2).split(",");
				let name = current_person[0];
				let gender = current_person[1];
				console.log("person: " + name + " sex: " + gender);
				if(gender == "m"){
					male.splice(i, 0, name);
				}else if(gender == "f"){
					female.splice(i, 0, name);
				}
			}
			compare_names(male, female);
			console.log(male + "\n" + female);
		}
		function compare_names(male, female){
			let len = male.length;
			if(female.length < male.length ) len = female.length; //we work with the least leng to avoid errors
			for(let j = 0; j < len; j++){
				let name1 = male[j];
				let name2 = female[j];
				calc_names(name1, name2);			
				//the function above store the results in the global var FINAL_RESULTS  
				let results = {
					Name1: name1,
					Name2: name2,
					Score: FINAL_RESULTS 
				};
				TEXT_OUTPUT.splice(j, 0, results); 
			}
			bubble_sort_text_output();
		}
		function bubble_sort_text_output(){
			let len = TEXT_OUTPUT.length;
			let checked;
			do{
				checked == false;
				for(let i = 0; i < len; i++){

					if(TEXT_OUTPUT[i].Score > TEXT_OUTPUT[i + 1].Score){
						let temp = TEXT_OUTPUT[i];
						TEXT_OUTPUT[i] = TEXT_OUTPUT[i+1];
						TEXT_OUTPUT[i+1] = temp;
						checked = true;
					}else if(TEXT_OUTPUT[i].Score == TEXT_OUTPUT[i + 1].Score){
						if(TEXT_OUTPUT[i].Name1 > TEXT_OUTPUT[i + 1].Name1){
							let temp = TEXT_OUTPUT[i];
							TEXT_OUTPUT[i] = TEXT_OUTPUT[i+1];
							TEXT_OUTPUT[i+1] = temp;
							checked = true;
						}
					}
				}
			}while(checked);
			console.log(TEXT_OUTPUT);
		}
	</script>
</body>
</html>